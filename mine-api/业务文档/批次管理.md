# 批次管理模块文档

## 1. 模块概述

批次管理模块负责处理与商品批次相关的所有操作。这包括查询批次信息、管理批次状态以及批量更新批次数据。批次信息对于库存跟踪、效期管理和成本核算至关重要。

## 2. 主要功能

*   查询批次列表：根据多种条件筛选批次信息。
*   查询特定商品的批次：获取某个商品的所有批次或仅有效批次。
*   批量更新：一次性更新多个批次的信息。

## 3. API 接口

### 3.1 查询批次列表

*   **路径:** `/batch/list`
*   **方法:** `POST`
*   **描述:** 根据查询条件获取批次列表。默认会包含关联的商品信息。
*   **请求体:** `BatchQuery` 对象 (JSON 格式)
    *   `includes`: (可选) `Set<String>` - 指定需要额外加载的关联数据，例如 `PRODUCT`。
    *   其他查询条件 (根据 `BatchQuery` 类定义)。
*   **响应:** `List<Batch>` - 符合条件的批次对象列表。

**请求示例:**

```json
{
  "shopId": 1,
  "status": true,
  "includes": ["PRODUCT"]
}
```

### 3.2 查询商品有效批次

*   **路径:** `/batch/product/{productId}/valid`
*   **方法:** `GET`
*   **描述:** 查询指定商品的所有有效（通常指未过期、状态正常）批次。
*   **路径参数:**
    *   `productId`: `Integer` - 商品的唯一标识符。
*   **响应:** `List<Batch>` - 该商品的有效批次列表。

### 3.3 查询商品所有批次

*   **路径:** `/batch/product/{productId}`
*   **方法:** `GET`
*   **描述:** 查询指定商品的所有批次，可以通过参数筛选特定状态的批次。
*   **路径参数:**
    *   `productId`: `Integer` - 商品的唯一标识符。
*   **查询参数:**
    *   `status`: (可选) `Boolean` - 批次状态 (例如 `true` 表示有效, `false` 表示无效)。
*   **响应:** `List<Batch>` - 该商品的批次列表。

### 3.4 批量更新批次信息

*   **路径:** `/batch/batch-update`
*   **方法:** `POST`
*   **描述:** 批量更新一个或多个批次的信息。
*   **请求体:** `List<BatchUpdateDto>` (JSON 格式)
    *   `BatchUpdateDto` 包含需要更新的批次 ID 和要修改的字段。
*   **响应:** 无内容 (HTTP 200 OK 表示成功)。

**请求示例:**

```json
[
  {
    "id": 101,
    "quantity": 95,
    "status": false
  },
  {
    "id": 102,
    "expiryDate": "2026-12-31"
  }
]
```

## 4. 关键数据结构

*   **`Batch` (Entity):** 代表数据库中的批次记录，包含批次号、商品ID、数量、生产日期、有效期、状态等信息。
*   **`BatchQuery` (Query Object):** 用于封装批次列表查询的各种条件。
*   **`BatchDto` (Data Transfer Object):** 可能用于数据传输，简化或聚合 `Batch` 实体信息。
*   **`BatchUpdateDto` (Data Transfer Object):** 用于批量更新批次时传递所需的数据。

## 5. 注意事项

*   查询批次列表时，合理使用 `includes` 参数以避免不必要的数据加载。
*   批量更新操作不提供部分成功的回滚，调用方需确保数据准确性。
