# 库存管理模块

## 模块概述
库存管理模块负责商品库存的增删改查，支持批次和非批次商品的库存管理。

## 核心实体
- Inventory: 库存记录实体，包含商品ID、批次ID、数量等信息
- InventoryTransaction: 库存变动记录(待完善)
- ProductStockDTO: 商品库存信息传输对象

## 主要功能
1. 库存操作:
   - 入库操作: stockIn() 支持批次和非批次商品
   - 出库操作: stockOut() 支持批次和非批次商品
   - 库存更新: update() 直接更新库存数量

2. 库存查询:
   - 单商品库存查询: getProductStock()
   - 批量商品库存查询: getProductStocks()
   - FIFO批次查询: findAvailableBatchesByFifo()

## 核心业务流程
1. 入库流程:
   - 查找或创建库存记录
   - 增加库存数量
   - 记录库存变动(待实现)

2. 出库流程: 
   - 检查库存是否充足
   - 减少库存数量
   - 记录库存变动(待实现)

3. 库存查询流程:
   - 构建查询条件
   - 关联加载商品和批次信息
   - 计算总库存和批次库存

## 特殊处理
1. 批次管理:
   - 支持FIFO(先进先出)批次分配
   - 批次库存与非批次库存分开管理

2. 并发控制:
   - 使用@Transactional保证数据一致性
   - 出库前检查库存防止超卖

## 与其他模块关系
- 依赖产品模块获取商品信息
- 依赖批次模块获取批次信息
- 为订单模块提供库存检查和扣减功能
- 与采购模块交互处理入库
