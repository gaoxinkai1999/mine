# 店铺管理模块文档

## 1. 模块概述

店铺管理模块负责维护系统中的所有店铺（或称为商家、客户）信息。它存储了店铺的基本资料，如名称、联系方式、地址、状态等，并提供相关的查询和管理功能。

主要实体：
*   **`Shop`:** 代表一个店铺或商家，包含其所有属性。

## 2. 主要功能

*   **店铺信息管理:** 创建、更新店铺的基本信息。
*   **店铺查询:**
    *   获取单个店铺的详细信息。
    *   获取所有店铺的简化列表。
    *   按名称模糊搜索店铺。
    *   按拼音首字母分组店铺列表。
    *   获取所有店铺的位置信息列表。
*   **欠款查询:** 获取所有店铺的欠款信息汇总。

## 3. API 接口 (ShopController - `/shop`)

### 3.1 新建店铺

*   **路径:** `/shop/create`
*   **方法:** `POST`
*   **描述:** 创建一个新的店铺。
*   **请求体:** `ShopDto` 对象 (JSON 格式) - 包含新店铺的各项属性（名称、地址、联系人、电话等）。
*   **响应:** 无内容 (HTTP 200 OK 表示成功)。

### 3.2 更新店铺信息 (批量)

*   **路径:** `/shop/update`
*   **方法:** `POST`
*   **描述:** 批量更新一个或多个店铺的信息。
*   **请求体:** `List<ShopRequestDto>` (JSON 格式) - 包含需要更新的店铺 ID 和要修改的字段。
*   **响应:** 无内容 (HTTP 200 OK 表示成功)。

### 3.3 获取单个店铺

*   **路径:** `/shop/get`
*   **方法:** `GET`
*   **描述:** 根据店铺 ID 获取该店铺的详细信息。
*   **请求参数:**
    *   `id`: `Integer` - 店铺 ID。
*   **响应:** `ShopDto` - 包含完整信息的店铺 DTO。

### 3.4 获取店铺列表 (简化信息)

*   **路径:** `/shop/list`
*   **方法:** `GET`
*   **描述:** 获取所有（未被删除的）店铺的简化信息列表。
*   **响应:** `List<ShopSimpleDto>` - 包含店铺 ID 和名称等基本信息的 DTO 列表。

### 3.5 模糊查询商家

*   **路径:** `/shop/search`
*   **方法:** `GET`
*   **描述:** 根据提供的名称关键字进行模糊匹配，查询店铺列表。
*   **请求参数:**
    *   `name`: (可选) `String` - 店铺名称的关键字。
*   **响应:** `List<ShopSimpleDto>` - 匹配的店铺简化信息列表。

### 3.6 按拼音分组门店

*   **路径:** `/shop/group-by-pinyin`
*   **方法:** `GET`
*   **描述:** 获取所有（未被删除的）店铺，并根据店铺名称的拼音首字母进行分组。
*   **响应:** `Map<Character, List<ShopSimpleDto>>` - 一个 Map，键是拼音首字母（大写），值是该字母开头的店铺简化信息列表。

### 3.7 获取店铺位置信息列表

*   **路径:** `/shop/locations`
*   **方法:** `GET`
*   **描述:** 获取所有（未被删除且设置了位置信息的）店铺的位置信息列表。
*   **响应:** `List<ShopLocationDto>` - 包含店铺 ID、名称、经纬度等位置信息的 DTO 列表。

### 3.8 获取商家欠款数据

*   **路径:** `/shop/arrears`
*   **方法:** `GET`
*   **描述:** 获取所有店铺的欠款信息汇总。
*   **响应:** `List<ShopArrearsDto>` - 包含店铺 ID、名称和欠款金额的 DTO 列表。

## 4. 关键数据结构

*   **`Shop` (Entity):** 店铺实体，包含 `id`, `name`, `address`, `contactPerson`, `phone`, `status`, `isDel` (是否软删除), `latitude`, `longitude`, `pinyin` 等字段。
*   **`ShopDto` (DTO):** 店铺的完整数据传输对象。
*   **`ShopRequestDto` (DTO):** 用于更新店铺信息的请求数据。
*   **`ShopSimpleDto` (DTO):** 店铺的简化数据传输对象，通常只包含 ID 和名称。
*   **`ShopLocationDto` (DTO):** 包含店铺位置信息（ID, 名称, 经纬度）的数据传输对象。
*   **`ShopArrearsDto` (DTO):** 包含店铺欠款信息（ID, 名称, 欠款金额）的数据传输对象。

## 5. 注意事项

*   店铺信息也可能采用软删除机制 (`isDel` 字段)。查询接口通常只返回 `isDel=false` 的店铺。
*   店铺名称的拼音字段 (`pinyin`) 用于支持按拼音分组的功能，需要在创建或更新店铺时维护。
*   欠款信息的计算逻辑在 `ShopService` 中实现，`ShopController` 只负责暴露查询接口。
