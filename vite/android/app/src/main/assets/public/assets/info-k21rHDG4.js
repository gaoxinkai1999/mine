import{k as r,m as d,f as F,c as v,b as t,v as b,w as s,y as g,D as B,P as V,g as c,x as w,d as _,B as N}from"./index-C0qELFvz.js";/* empty css              */import"./index-C-sx0Abo.js";import{C as x}from"./index-CJZx8lX5.js";import{C as D}from"./index-KpkTHw7S.js";import{F as E}from"./index-l99pA0pT.js";import{N as I}from"./index-DvCqQQ0t.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{F as T}from"./index-DkOwyQJK.js";import{P as S}from"./index-BHDKT0-x.js";import"./use-id-DTylsVlq.js";function U(){return{navigateToLocation:(e,h,a)=>{const o="amapuri://route/plan/?did=&dlon="+e+"&dlat="+h+"&dname="+a+"&dev=0&t=0";window.location.href=o}}}const z={name:"ShopInfo",props:{id:Number},setup(){const{navigateToLocation:l}=U();return{navigateToLocation:l}},data(){return{shop:"",orders:[],showEditDialog:!1,showPriceRulePicker:!1,priceRules:[],editForm:{name:"",priceRule:{name:"",id:null}},customFieldName:{text:"name"}}},async mounted(){await this.findById(),await this.loadPriceRules()},methods:{async loadPriceRules(){try{const l=await r.pricerule.getSimplePriceRules();this.priceRules=l}catch{d("获取价格规则失败")}},handleBeforeClose(l){return l==="confirm"&&this.updateShop(),!0},onPriceRuleConfirm({selectedOptions:l}){this.editForm.priceRule=l,this.showPriceRulePicker=!1},async updateShop(){try{await r.shop.update([{id:this.shop.id,name:this.editForm.name,priceRuleId:this.editForm.priceRule.id}]),d({type:"success",message:"更新成功"}),await this.findById()}catch{d({type:"fail",message:"更新失败"})}},async findById(){this.shop=await r.shop.getShop({id:this.$route.query.id}),this.editForm={name:this.shop.name,priceRule:{...this.shop.priceRule}}},setArrears(){F({title:"确认修改"}).then(()=>{r.shop.update([{id:this.shop.id,arrears:this.shop.arrears}])})},setLocation(){}}},A={key:0,style:{"margin-top":"3vh"}},q={style:{"margin-top":"3vh"}},G={class:"edit-form"};function j(l,e,h,a,o,n){const R=I,u=D,m=E,p=x,f=N,k=T,y=B,C=S,P=V;return c(),v("div",null,[t(R,{"right-text":"编辑商家",title:"商家信息",onClickRight:e[0]||(e[0]=i=>o.showEditDialog=!0)}),o.shop!==""?(c(),b(p,{key:0,inset:"",title:"基本信息"},{default:s(()=>[t(u,{value:o.shop.location,size:"large",title:"地区"},null,8,["value"]),t(u,{value:o.shop.name,size:"large",title:"商家名"},null,8,["value"]),t(u,{value:o.shop.priceRule.name,size:"large",title:"价格规则"},null,8,["value"]),t(m,{modelValue:o.shop.arrears,"onUpdate:modelValue":e[1]||(e[1]=i=>o.shop.arrears=i),"input-align":"right",label:"欠款",size:"large",type:"digit",onChange:e[2]||(e[2]=i=>n.setArrears())},null,8,["modelValue"])]),_:1})):g("",!0),t(p,{inset:"",title:"位置信息"},{default:s(()=>[o.shop.longitude!==null?(c(),v("div",A,[t(f,{block:"",color:"#8BC96E",style:{"margin-top":"3vh"},onClick:e[3]||(e[3]=i=>a.navigateToLocation())},{default:s(()=>e[10]||(e[10]=[w("开启导航")])),_:1})])):g("",!0),_("div",q,[t(f,{block:"",color:"#AF5F4E",style:{"margin-top":"3vh"},onClick:n.setLocation},{default:s(()=>e[11]||(e[11]=[w("修改坐标为当前位置")])),_:1},8,["onClick"])])]),_:1}),t(y,{show:o.showEditDialog,"onUpdate:show":e[7]||(e[7]=i=>o.showEditDialog=i),title:"编辑商家信息","show-cancel-button":"","before-close":n.handleBeforeClose},{default:s(()=>[_("div",G,[t(k,null,{default:s(()=>[t(p,{inset:""},{default:s(()=>[t(m,{modelValue:o.editForm.name,"onUpdate:modelValue":e[4]||(e[4]=i=>o.editForm.name=i),label:"商家名",placeholder:"请输入商家名称",rules:[{required:!0,message:"请输入商家名称"}]},null,8,["modelValue"]),t(m,{modelValue:o.editForm.priceRule.name,"onUpdate:modelValue":e[5]||(e[5]=i=>o.editForm.priceRule.name=i),"is-link":"",readonly:"",label:"价格规则",placeholder:"请选择价格规则",onClick:e[6]||(e[6]=i=>o.showPriceRulePicker=!0)},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["show","before-close"]),t(P,{show:o.showPriceRulePicker,"onUpdate:show":e[9]||(e[9]=i=>o.showPriceRulePicker=i),position:"bottom",round:""},{default:s(()=>[t(C,{columns:o.priceRules,"columns-field-names":o.customFieldName,onConfirm:n.onPriceRuleConfirm,onCancel:e[8]||(e[8]=i=>o.showPriceRulePicker=!1),"show-toolbar":"",title:"选择价格规则"},null,8,["columns","columns-field-names","onConfirm"])]),_:1},8,["show"])])}const ee=L(z,[["render",j],["__scopeId","data-v-b414673a"]]);export{ee as default};
