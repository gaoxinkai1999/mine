import{h as F,r as c,j as x,l as O,k as S,m as B,n as L,p as $,s as j,c as z,d as a,t as w,u as b,b as r,w as I,F as D,P as E,g as M,I as U}from"./index-C0qELFvz.js";/* empty css              */import{N as V}from"./index-DvCqQQ0t.js";import{_ as q}from"./ShopListItem-DMELL755.js";import{_ as R}from"./nearShopList-OpVUD0zr.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as G,a as H}from"./index-Dx3zNtAq.js";const J=F("order",()=>{const C=c({}),_=c(0),i=c([]),n=c([]),s=c([]),l=c([{id:128,name:"育青苑小卖部",latitude:37.602938,longitude:112.348135,address:"育青苑小区",distance:43.45429229736328},{id:243,name:"晋乐山驴肉店",latitude:37.60148,longitude:112.350471,address:"商业南街",distance:270.90704345703125}]),p=c(!1),e=c({}),d=x(()=>n.value.filter(o=>{var t;return o.categoryId==((t=i.value[_.value])==null?void 0:t.id)})),P=x(()=>s.value.reduce((o,t)=>o+t.price*t.count,0)),h=x(()=>s.value.reduce((o,t)=>o+t.count,0));async function T(){await k(),await Promise.all([m(),g()])}async function k(){try{const o=await O.getNearbyShops();C.value=o.currentLocation,l.value=o.nearbyShops}catch(o){console.error("获取位置信息失败:",o)}finally{const o=await S.shop.getShop({id:l.value[0].id});e.value={...o,distance:l.value[0].distance}}}async function m(){try{i.value=await S.category.getCategories()}catch(o){console.error("获取分类失败:",o)}}async function g(){try{const o=await S.product.getProductSaleList({shopId:e.value.id});n.value=o.map(t=>({...t,count:0}))}catch(o){console.error("获取商品失败:",o)}}function y(o){const t=s.value.find(v=>v.id===o.id);o.count===0?s.value=s.value.filter(v=>v.id!==o.id):t?t.count=o.count:s.value.push({id:o.id,name:o.name,price:o.price,count:o.count});const N=n.value.find(v=>v.id===o.id);N&&(N.count=o.count)}function f(){s.value=[],n.value.forEach(o=>o.count=0)}async function u(){if(s.value.length===0)return B("请先选择商品"),!1;try{const o={shopId:e.value.id,items:s.value.map(t=>({productId:t.id,quantity:t.count,price:t.price}))};return await S.order.createOrder(o),L("下单成功"),f(),!0}catch(o){return console.error("下单失败:",o),$("下单失败，请重试"),!1}}return{activeCategory:_,categories:i,foods:n,cart:s,nearbyShops:l,showCart:p,currentLocation:C,currentShop:e,currentFoods:d,totalPrice:P,totalCount:h,init:T,updateCart:y,clearCart:f,submitOrder:u}}),K={class:"shop-info"},Q={class:"shop-info__header"},W={class:"shop-name"},X={class:"shop-info__details"},Y={class:"info-item"},Z={class:"info-row"},oo={class:"info-item"},to={class:"info-item"},eo={class:"info-item"},ao={__name:"ShopInfo",setup(C){const _=J(),{currentShop:i}=j(_),n=c(!1),s=c(0),l=p=>{i.value=p,n.value=!1,console.log(p)};return(p,e)=>{var m,g,y,f;const d=U,P=V,h=G,T=H,k=E;return M(),z(D,null,[a("div",K,[a("div",{class:"shop-info__content",onClick:e[0]||(e[0]=u=>n.value=!n.value)},[a("div",Q,[a("h2",W,w(((m=b(i))==null?void 0:m.name)||"加载中..."),1),r(d,{name:"arrow"})]),a("div",X,[a("div",Y,[a("span",null,w(((g=b(i))==null?void 0:g.address)||""),1)]),a("div",Z,[a("div",oo,[r(d,{name:"guide-o"}),a("span",null,"距离 "+w(Math.round(((y=b(i))==null?void 0:y.distance)||0))+"米",1)]),a("div",to,[r(d,{name:"clock-o"}),e[4]||(e[4]=a("span",null,"营业时间 09:00-22:00",-1))])]),a("div",eo,[r(d,{name:"info-o"}),a("span",null,w(((f=b(i))==null?void 0:f.notice)||"欢迎光临，请尽情选购"),1)])])])]),r(k,{show:n.value,"onUpdate:show":e[3]||(e[3]=u=>n.value=u),position:"bottom",style:{height:"80%"},"z-index":3e3,"overlay-style":{zIndex:2900}},{default:I(()=>[r(P,{"left-text":"关闭",title:"选择商家",onClickLeft:e[1]||(e[1]=u=>n.value=!1)}),r(T,{active:s.value,"onUpdate:active":e[2]||(e[2]=u=>s.value=u)},{default:I(()=>[r(h,{title:"附近商家"},{default:I(()=>[r(R,{onSelectShop:l})]),_:1}),r(h,{title:"全部商家"},{default:I(()=>[r(q,{onSelectShop:l})]),_:1})]),_:1},8,["active"])]),_:1},8,["show"])],64)}}},so=A(ao,[["__scopeId","data-v-832eecc3"]]),fo=Object.freeze(Object.defineProperty({__proto__:null,default:so},Symbol.toStringTag,{value:"Module"}));export{so as S,fo as a,J as u};
