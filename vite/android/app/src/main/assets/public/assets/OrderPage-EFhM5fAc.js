import{p as h,n as F,c as f,b as r,w as l,g as d,b4 as P,d as c,x as u,t as g,v as N,y as T,F as w,I as x,P as O,B}from"./index-C0qELFvz.js";/* empty css              */import"./index-C-sx0Abo.js";import{C as L}from"./index-CRs7Aw4B.js";import{_ as C}from"./ShopListItem-DMELL755.js";import"./index-KpkTHw7S.js";import{F as R}from"./index-l99pA0pT.js";import{T as U}from"./index-DpkCpmyv.js";import{N as V}from"./index-DvCqQQ0t.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{F as q}from"./index-DkOwyQJK.js";import{P as A}from"./index-BHDKT0-x.js";import"./use-refs-HP3ZCcq4.js";import"./index-CzMMTJ2E.js";import"./use-id-DTylsVlq.js";const J={name:"ChooseOrder",components:{ShopListItem:C},data(){return{showCalendar:!1,showCalendarRange:!1,showPicker:!1,showDateTypePopup:!1,dateType:"single",dateTypeOptions:{single:"单日查询",range:"日期范围",none:"不限日期"},shops:[],shop:{},form:{shopId:null,startDate:null,endDate:null}}},computed:{dateRangeText(){return this.form.startDate&&this.form.endDate?`${this.form.startDate} 至 ${this.form.endDate}`:""},dateTypeLabel(){return this.dateTypeOptions[this.dateType]||"请选择日期类型"},dateTypeColumns(){return Object.entries(this.dateTypeOptions).map(([e,t])=>({text:t,value:e}))}},created(){this.restoreFilters()},methods:{restoreFilters(){try{const{shopId:e,shopName:t,startDate:a,endDate:i}=this.$route.query;if(e&&(this.form.shopId=e,t)){const o=t.match(/\(([^)]+)\)(.+)/);o?this.shop={id:e,location:o[1],name:o[2].trim()}:this.shop={id:e,name:t}}if(a?(this.form.startDate=a,i&&i!==a?(this.form.endDate=i,this.dateType="range"):(this.form.endDate=a,this.dateType="single")):(this.dateType="none",this.form.startDate=null,this.form.endDate=null),!e&&!a){const o=localStorage.getItem("orderFilters");if(o)try{const s=JSON.parse(o);if(s.shopId&&(this.form.shopId=s.shopId,s.shopName)){const p=s.shopName.match(/\(([^)]+)\)(.+)/);p?this.shop={id:s.shopId,location:p[1],name:p[2].trim()}:this.shop={id:s.shopId,name:s.shopName}}s.startDate?(this.form.startDate=s.startDate,s.endDate&&s.endDate!==s.startDate?(this.form.endDate=s.endDate,this.dateType="range"):(this.form.endDate=s.startDate,this.dateType="single")):(this.dateType="none",this.form.startDate=null,this.form.endDate=null)}catch(s){console.error("解析localStorage中的筛选条件出错:",s),localStorage.removeItem("orderFilters")}}console.log("已还原筛选条件:",{shop:this.shop,dateType:this.dateType,startDate:this.form.startDate,endDate:this.form.endDate})}catch(e){console.error("还原筛选条件出错:",e),h("还原筛选条件失败")}},onSubmit(){try{const e={};if(this.form.shopId&&(e.shopId=this.form.shopId,this.shop&&this.shop.name)){const t=this.shop.location?`(${this.shop.location})`:"";e.shopName=`${t}${this.shop.name}`}this.dateType==="single"&&this.form.startDate?(e.startDate=this.form.startDate,e.endDate=this.form.startDate):this.dateType==="range"&&(this.form.startDate&&(e.startDate=this.form.startDate),this.form.endDate&&(e.endDate=this.form.endDate)),localStorage.setItem("orderFilters",JSON.stringify(e)),this.$router.push({path:"/order/list",query:e}),F("筛选条件已应用"),console.log("提交筛选条件:",e)}catch(e){console.error("提交筛选条件出错:",e),h("应用筛选条件失败")}},onConfirmDateType(e){try{if(!e||typeof e!="object"){console.error("无效的日期类型选择:",e);return}this.dateType=e.value,this.showDateTypePopup=!1,this.dateType==="none"&&(this.form.startDate=null,this.form.endDate=null),console.log("已选择日期类型:",this.dateType,this.dateTypeOptions[this.dateType])}catch(t){console.error("选择日期类型出错:",t),h("选择日期类型失败")}},onConfirmDate(e){try{if(!e||!(e instanceof Date)){console.error("无效的日期:",e);return}const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");this.form.startDate=`${t}-${a}-${i}`,this.form.endDate=this.form.startDate,this.showCalendar=!1,console.log("已选择日期:",this.form.startDate)}catch(t){console.error("选择日期出错:",t),h("选择日期失败")}},onConfirmDateRange(e){try{if(!Array.isArray(e)||e.length<2||!(e[0]instanceof Date)||!(e[1]instanceof Date)){console.error("无效的日期范围:",e);return}const t=a=>{const i=a.getFullYear(),o=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0");return`${i}-${o}-${s}`};this.form.startDate=t(e[0]),this.form.endDate=t(e[1]),this.showCalendarRange=!1,console.log("已选择日期范围:",this.form.startDate,"至",this.form.endDate)}catch(t){console.error("选择日期范围出错:",t),h("选择日期范围失败")}},receiveDataFromChild(e){try{if(!e||!e.id){console.error("接收到无效的商店数据:",e);return}this.shop=e,this.form.shopId=e.id,this.showPicker=!1,console.log("已选择商店:",e)}catch(t){console.error("选择商店出错:",t),h("选择商店失败")}}}},M={class:"shop-list-container"},Y={style:{margin:"16px"}};function E(e,t,a,i,o,s){const p=V,_=U,m=R,v=x,b=C,y=O,S=A,D=L,k=B,I=q;return d(),f("div",null,[r(p,{title:"筛选订单"}),r(I,{onSubmit:s.onSubmit},{default:l(()=>[r(m,{"is-link":"",label:"商家",placeholder:"选择商家",readonly:"",onClick:t[0]||(t[0]=n=>o.showPicker=!0)},P({_:2},[o.shop.id!==void 0?{name:"input",fn:l(()=>[c("span",null,[u(g(o.shop.location?`(${o.shop.location})`:"")+g(o.shop.name)+" ",1),o.shop.isDel?(d(),N(_,{key:0,type:"danger"},{default:l(()=>t[10]||(t[10]=[u("弃用")])),_:1})):T("",!0)])]),key:"0"}:void 0]),1024),r(y,{show:o.showPicker,"onUpdate:show":t[2]||(t[2]=n=>o.showPicker=n),position:"bottom",style:{height:"80%"},teleport:"body",round:""},{default:l(()=>[r(p,{title:"选择商家"},{right:l(()=>[r(v,{name:"cross",onClick:t[1]||(t[1]=n=>o.showPicker=!1)})]),_:1}),c("div",M,[r(b,{onSelectShop:s.receiveDataFromChild},null,8,["onSelectShop"])])]),_:1},8,["show"]),r(m,{name:"dateType",label:"日期类型","is-link":"",readonly:"","model-value":s.dateTypeLabel,onClick:t[3]||(t[3]=n=>o.showDateTypePopup=!0)},null,8,["model-value"]),r(y,{show:o.showDateTypePopup,"onUpdate:show":t[5]||(t[5]=n=>o.showDateTypePopup=n),position:"bottom",round:"",teleport:"body"},{default:l(()=>[r(S,{title:"选择日期类型",columns:s.dateTypeColumns,onConfirm:s.onConfirmDateType,onCancel:t[4]||(t[4]=n=>o.showDateTypePopup=!1),"show-toolbar":""},null,8,["columns","onConfirm"])]),_:1},8,["show"]),o.dateType==="single"?(d(),f(w,{key:0},[r(m,{"model-value":o.form.startDate,"is-link":"",label:"日期",name:"calendar",placeholder:"点击选择日期",readonly:"",onClick:t[6]||(t[6]=n=>o.showCalendar=!0)},null,8,["model-value"]),r(D,{show:o.showCalendar,"onUpdate:show":t[7]||(t[7]=n=>o.showCalendar=n),onConfirm:s.onConfirmDate,round:"",teleport:"body"},null,8,["show","onConfirm"])],64)):o.dateType==="range"?(d(),f(w,{key:1},[r(m,{"model-value":s.dateRangeText,"is-link":"",label:"日期范围",name:"calendarRange",placeholder:"点击选择日期范围",readonly:"",onClick:t[8]||(t[8]=n=>o.showCalendarRange=!0)},null,8,["model-value"]),r(D,{show:o.showCalendarRange,"onUpdate:show":t[9]||(t[9]=n=>o.showCalendarRange=n),type:"range",onConfirm:s.onConfirmDateRange,round:"",teleport:"body"},null,8,["show","onConfirm"])],64)):T("",!0),c("div",Y,[r(k,{block:"","native-type":"submit",round:"",type:"primary"},{default:l(()=>t[11]||(t[11]=[u("确认筛选条件")])),_:1})])]),_:1},8,["onSubmit"])])}const ae=j(J,[["render",E],["__scopeId","data-v-8a829bb1"]]);export{ae as default};
