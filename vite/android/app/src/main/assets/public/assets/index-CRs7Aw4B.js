import{C as p,av as Re,bj as Pe,E as ee,bk as Se,b9 as Ae,j as b,b as d,bl as Oe,r as K,bm as Be,H as Ie,b8 as Me,M as oe,bc as le,bn as He,ax as X,O as Z,I as he,bo as ve,A as ne,bp as Ye,P as Fe,N as I,ay as We,bq as re,br as ae,bb as _e,S as $e,m as ge,B as Ne,U as Ee}from"./index-C0qELFvz.js";import{u as ze}from"./use-refs-HP3ZCcq4.js";import{p as je}from"./index-C-sx0Abo.js";const[Ve,h,$]=p("calendar"),Ue=e=>$("monthTitle",e.getFullYear(),e.getMonth()+1);function U(e,o){const a=e.getFullYear(),f=o.getFullYear();if(a===f){const w=e.getMonth(),M=o.getMonth();return w===M?0:w>M?1:-1}return a>f?1:-1}function P(e,o){const a=U(e,o);if(a===0){const f=e.getDate(),w=o.getDate();return f===w?0:f>w?1:-1}return a}const L=e=>new Date(e),De=e=>Array.isArray(e)?e.map(L):L(e);function se(e,o){const a=L(e);return a.setDate(a.getDate()+o),a}function ue(e,o){const a=L(e);return a.setMonth(a.getMonth()+o),a.getDate()!==e.getDate()&&a.setDate(0),a}function xe(e,o){const a=L(e);return a.setFullYear(a.getFullYear()+o),a.getDate()!==e.getDate()&&a.setDate(0),a}const ie=e=>se(e,-1),ce=e=>se(e,1),ye=e=>ue(e,-1),be=e=>ue(e,1),we=e=>xe(e,-1),ke=e=>xe(e,1),Q=()=>{const e=new Date;return e.setHours(0,0,0,0),e};function qe(e){const o=e[0].getTime();return(e[1].getTime()-o)/(1e3*60*60*24)+1}Re({},je,{modelValue:Pe(),filter:Function,formatter:{type:Function,default:(e,o)=>o}});const Ke=(e,o)=>32-new Date(e,o-1,32).getDate(),[Le]=p("calendar-day");var Ge=ee({name:Le,props:{item:Se(Object),color:String,index:Number,offset:Ae(0),rowHeight:String},emits:["click","clickDisabledDate"],setup(e,{emit:o,slots:a}){const f=b(()=>{var m;const{item:g,index:c,color:R,offset:l,rowHeight:v}=e,x={height:v};if(g.type==="placeholder")return x.width="100%",x;if(c===0&&(x.marginLeft=`${100*l/7}%`),R)switch(g.type){case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":x.background=R;break;case"middle":x.color=R;break}return l+(((m=g.date)==null?void 0:m.getDate())||1)>28&&(x.marginBottom=0),x}),w=()=>{e.item.type!=="disabled"?o("click",e.item):o("clickDisabledDate",e.item)},M=()=>{const{topInfo:m}=e.item;if(m||a["top-info"])return d("div",{class:h("top-info")},[a["top-info"]?a["top-info"](e.item):m])},A=()=>{const{bottomInfo:m}=e.item;if(m||a["bottom-info"])return d("div",{class:h("bottom-info")},[a["bottom-info"]?a["bottom-info"](e.item):m])},H=()=>a.text?a.text(e.item):e.item.text,Y=()=>{const{item:m,color:g,rowHeight:c}=e,{type:R}=m,l=[M(),H(),A()];return R==="selected"?d("div",{class:h("selected-day"),style:{width:c,height:c,background:g}},[l]):l};return()=>{const{type:m,className:g}=e.item;return m==="placeholder"?d("div",{class:h("day"),style:f.value},null):d("div",{role:"gridcell",style:f.value,class:[h("day",m),g],tabindex:m==="disabled"?void 0:-1,onClick:w},[Y()])}}});const[Je]=p("calendar-month"),Qe={date:Se(Date),type:String,color:String,minDate:Date,maxDate:Date,showMark:Boolean,rowHeight:oe,formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number};var Xe=ee({name:Je,props:Qe,emits:["click","clickDisabledDate"],setup(e,{emit:o,slots:a}){const[f,w]=Oe(),M=K(),A=K(),H=Be(A),Y=b(()=>Ue(e.date)),m=b(()=>Ie(e.rowHeight)),g=b(()=>{const r=e.date.getDate(),s=(e.date.getDay()-r%7+8)%7;return e.firstDayOfWeek?(s+7-e.firstDayOfWeek)%7:s}),c=b(()=>Ke(e.date.getFullYear(),e.date.getMonth()+1)),R=b(()=>f.value||!e.lazyRender),l=()=>Y.value,v=r=>{const D=s=>e.currentDate.some(y=>P(y,s)===0);if(D(r)){const s=ie(r),y=ce(r),T=D(s),W=D(y);return T&&W?"multiple-middle":T?"end":W?"start":"multiple-selected"}return""},x=r=>{const[D,s]=e.currentDate;if(!D)return"";const y=P(r,D);if(!s)return y===0?"start":"";const T=P(r,s);return e.allowSameDay&&y===0&&T===0?"start-end":y===0?"start":T===0?"end":y>0&&T<0?"middle":""},F=r=>{const{type:D,minDate:s,maxDate:y,currentDate:T}=e;if(s&&P(r,s)<0||y&&P(r,y)>0)return"disabled";if(T===null)return"";if(Array.isArray(T)){if(D==="multiple")return v(r);if(D==="range")return x(r)}else if(D==="single")return P(r,T)===0?"selected":"";return""},O=r=>{if(e.type==="range"){if(r==="start"||r==="end")return $(r);if(r==="start-end")return`${$("start")}/${$("end")}`}},N=()=>{if(e.showMonthTitle)return d("div",{class:h("month-title")},[a["month-title"]?a["month-title"]({date:e.date,text:Y.value}):Y.value])},G=()=>{if(e.showMark&&R.value)return d("div",{class:h("month-mark")},[e.date.getMonth()+1])},E=b(()=>{const r=Math.ceil((c.value+g.value)/7);return Array(r).fill({type:"placeholder"})}),j=b(()=>{const r=[],D=e.date.getFullYear(),s=e.date.getMonth();for(let y=1;y<=c.value;y++){const T=new Date(D,s,y),W=F(T);let J={date:T,type:W,text:y,bottomInfo:O(W)};e.formatter&&(J=e.formatter(J)),r.push(J)}return r}),q=b(()=>j.value.filter(r=>r.type==="disabled")),V=(r,D)=>{if(M.value){const s=le(M.value),y=E.value.length,W=(Math.ceil((D.getDate()+g.value)/7)-1)*s.height/y;He(r,s.top+W+r.scrollTop-le(r).top)}},z=(r,D)=>d(Ge,{item:r,index:D,color:e.color,offset:g.value,rowHeight:m.value,onClick:s=>o("click",s),onClickDisabledDate:s=>o("clickDisabledDate",s)},X(a,["top-info","bottom-info","text"])),te=()=>d("div",{ref:M,role:"grid",class:h("days")},[G(),(R.value?j:E).value.map(z)]);return Me({getTitle:l,getHeight:()=>H.value,setVisible:w,scrollToDate:V,disabledDays:q}),()=>d("div",{class:h("month"),ref:A},[N(),te()])}});const[Ze]=p("calendar-header");var pe=ee({name:Ze,props:{date:Date,minDate:Date,maxDate:Date,title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number,switchMode:Z("none")},emits:["clickSubtitle","panelChange"],setup(e,{slots:o,emit:a}){const f=b(()=>e.date&&e.minDate&&U(ye(e.date),e.minDate)<0),w=b(()=>e.date&&e.minDate&&U(we(e.date),e.minDate)<0),M=b(()=>e.date&&e.maxDate&&U(be(e.date),e.maxDate)>0),A=b(()=>e.date&&e.maxDate&&U(ke(e.date),e.maxDate)>0),H=()=>{if(e.showTitle){const l=e.title||$("title"),v=o.title?o.title():l;return d("div",{class:h("header-title")},[v])}},Y=l=>a("clickSubtitle",l),m=l=>a("panelChange",l),g=l=>{const v=e.switchMode==="year-month",x=o[l?"next-month":"prev-month"],F=o[l?"next-year":"prev-year"],O=l?M.value:f.value,N=l?A.value:w.value,G=l?"arrow":"arrow-left",E=l?"arrow-double-right":"arrow-double-left",j=()=>m((l?be:ye)(e.date)),q=()=>m((l?ke:we)(e.date)),V=d("view",{class:h("header-action",{disabled:O}),onClick:O?void 0:j},[x?x({disabled:O}):d(he,{class:{[ve]:!O},name:G},null)]),z=v&&d("view",{class:h("header-action",{disabled:N}),onClick:N?void 0:q},[F?F({disabled:N}):d(he,{class:{[ve]:!N},name:E},null)]);return l?[V,z]:[z,V]},c=()=>{if(e.showSubtitle){const l=o.subtitle?o.subtitle({date:e.date,text:e.subtitle}):e.subtitle,v=e.switchMode!=="none";return d("div",{class:h("header-subtitle",{"with-switch":v}),onClick:Y},[v?[g(),d("div",{class:h("header-subtitle-text")},[l]),g(!0)]:l])}},R=()=>{const{firstDayOfWeek:l}=e,v=$("weekdays"),x=[...v.slice(l,7),...v.slice(0,l)];return d("div",{class:h("weekdays")},[x.map(F=>d("span",{class:h("weekday")},[F]))])};return()=>d("div",{class:h("header")},[H(),c(),R()])}});const et={show:Boolean,type:Z("single"),switchMode:Z("none"),title:String,color:String,round:I,readonly:Boolean,poppable:I,maxRange:We(null),position:Z("bottom"),teleport:[String,Object],showMark:I,showTitle:I,formatter:Function,rowHeight:oe,confirmText:String,rangePrompt:String,lazyRender:I,showConfirm:I,defaultDate:[Date,Array],allowSameDay:Boolean,showSubtitle:I,closeOnPopstate:I,showRangePrompt:I,confirmDisabledText:String,closeOnClickOverlay:I,safeAreaInsetTop:Boolean,safeAreaInsetBottom:I,minDate:{type:Date,validator:re},maxDate:{type:Date,validator:re},firstDayOfWeek:{type:oe,default:0,validator:e=>e>=0&&e<=6}};var tt=ee({name:Ve,props:et,emits:["select","confirm","unselect","monthShow","overRange","update:show","clickSubtitle","clickDisabledDate","panelChange"],setup(e,{emit:o,slots:a}){const f=b(()=>e.switchMode!=="none"),w=b(()=>!e.minDate&&!f.value?Q():e.minDate),M=b(()=>!e.maxDate&&!f.value?ue(Q(),6):e.maxDate),A=(t,n=w.value,u=M.value)=>n&&P(t,n)===-1?n:u&&P(t,u)===1?u:t,H=(t=e.defaultDate)=>{const{type:n,allowSameDay:u}=e;if(t===null)return t;const i=Q();if(n==="range"){Array.isArray(t)||(t=[]),t.length===1&&P(t[0],i)===1&&(t=[]);const k=w.value,C=M.value,_=A(t[0]||i,k,C?u?C:ie(C):void 0),S=A(t[1]||(u?i:ce(i)),k?u?k:ce(k):void 0);return[_,S]}return n==="multiple"?Array.isArray(t)?t.map(k=>A(k)):[A(i)]:((!t||Array.isArray(t))&&(t=i),A(t))},Y=()=>{const t=Array.isArray(c.value)?c.value[0]:c.value;return t||A(Q())};let m;const g=K(),c=K(H()),R=K(Y()),l=K(),[v,x]=ze(),F=b(()=>e.firstDayOfWeek?+e.firstDayOfWeek%7:0),O=b(()=>{const t=[];if(!w.value||!M.value)return t;const n=new Date(w.value);n.setDate(1);do t.push(new Date(n)),n.setMonth(n.getMonth()+1);while(U(n,M.value)!==1);return t}),N=b(()=>{if(c.value){if(e.type==="range")return!c.value[0]||!c.value[1];if(e.type==="multiple")return!c.value.length}return!c.value}),G=()=>c.value,E=()=>{const t=_e(g.value),n=t+m,u=O.value.map((S,B)=>v.value[B].getHeight()),i=u.reduce((S,B)=>S+B,0);if(n>i&&t>0)return;let k=0,C;const _=[-1,-1];for(let S=0;S<O.value.length;S++){const B=v.value[S];k<=n&&k+u[S]>=t&&(_[1]=S,C||(C=B,_[0]=S),v.value[S].showed||(v.value[S].showed=!0,o("monthShow",{date:B.date,title:B.getTitle()}))),k+=u[S]}O.value.forEach((S,B)=>{const me=B>=_[0]-1&&B<=_[1]+1;v.value[B].setVisible(me)}),C&&(l.value=C)},j=t=>{f.value?R.value=t:ae(()=>{O.value.some((n,u)=>U(n,t)===0?(g.value&&v.value[u].scrollToDate(g.value,t),!0):!1),E()})},q=()=>{if(!(e.poppable&&!e.show))if(c.value){const t=e.type==="single"?c.value:c.value[0];re(t)&&j(t)}else f.value||ae(E)},V=()=>{e.poppable&&!e.show||(f.value||ae(()=>{m=Math.floor(le(g).height)}),q())},z=(t=H())=>{c.value=t,q()},te=t=>{const{maxRange:n,rangePrompt:u,showRangePrompt:i}=e;return n&&qe(t)>+n?(i&&ge(u||$("rangePrompt",n)),o("overRange"),!1):!0},r=t=>{R.value=t,o("panelChange",{date:t})},D=()=>{var t;return o("confirm",(t=c.value)!=null?t:De(c.value))},s=(t,n)=>{const u=i=>{c.value=i,o("select",De(i))};if(n&&e.type==="range"&&!te(t)){u([t[0],se(t[0],+e.maxRange-1)]);return}u(t),n&&!e.showConfirm&&D()},y=(t,n,u)=>{var i;return(i=t.find(k=>P(n,k.date)===-1&&P(k.date,u)===-1))==null?void 0:i.date},T=b(()=>v.value.reduce((t,n)=>{var u,i;return t.push(...(i=(u=n.disabledDays)==null?void 0:u.value)!=null?i:[]),t},[])),W=t=>{if(e.readonly||!t.date)return;const{date:n}=t,{type:u}=e;if(u==="range"){if(!c.value){s([n]);return}const[i,k]=c.value;if(i&&!k){const C=P(n,i);if(C===1){const _=y(T.value,i,n);if(_){const S=ie(_);P(i,S)===-1?s([i,S]):s([n])}else s([i,n],!0)}else C===-1?s([n]):e.allowSameDay&&s([n,n],!0)}else s([n])}else if(u==="multiple"){if(!c.value){s([n]);return}const i=c.value,k=i.findIndex(C=>P(C,n)===0);if(k!==-1){const[C]=i.splice(k,1);o("unselect",L(C))}else e.maxRange&&i.length>=+e.maxRange?ge(e.rangePrompt||$("rangePrompt",e.maxRange)):s([...i,n])}else s(n,!0)},J=t=>o("update:show",t),de=(t,n)=>{const u=n!==0||!e.showSubtitle;return d(Xe,$e({ref:f.value?l:x(n),date:t,currentDate:c.value,showMonthTitle:u,firstDayOfWeek:F.value,lazyRender:f.value?!1:e.lazyRender,maxDate:M.value,minDate:w.value},X(e,["type","color","showMark","formatter","rowHeight","showSubtitle","allowSameDay"]),{onClick:W,onClickDisabledDate:i=>o("clickDisabledDate",i)}),X(a,["top-info","bottom-info","month-title","text"]))},Te=()=>{if(a.footer)return a.footer();if(e.showConfirm){const t=a["confirm-text"],n=N.value,u=n?e.confirmDisabledText:e.confirmText;return d(Ne,{round:!0,block:!0,type:"primary",color:e.color,class:h("confirm"),disabled:n,nativeType:"button",onClick:D},{default:()=>[t?t({disabled:n}):u||$("confirm")]})}},Ce=()=>d("div",{class:[h("footer"),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[Te()]),fe=()=>{var t,n;return d("div",{class:h()},[d(pe,{date:(t=l.value)==null?void 0:t.date,maxDate:M.value,minDate:w.value,title:e.title,subtitle:(n=l.value)==null?void 0:n.getTitle(),showTitle:e.showTitle,showSubtitle:e.showSubtitle,switchMode:e.switchMode,firstDayOfWeek:F.value,onClickSubtitle:u=>o("clickSubtitle",u),onPanelChange:r},X(a,["title","subtitle","prev-month","prev-year","next-month","next-year"])),d("div",{ref:g,class:h("body"),onScroll:f.value?void 0:E},[f.value?de(R.value,0):O.value.map(de)]),Ce()])};return ne(()=>e.show,V),ne(()=>[e.type,e.minDate,e.maxDate,e.switchMode],()=>z(H(c.value))),ne(()=>e.defaultDate,t=>{z(t)}),Me({reset:z,scrollToDate:j,getSelectedDate:G}),Ye(V),()=>e.poppable?d(Fe,{show:e.show,class:h("popup"),round:e.round,position:e.position,closeable:e.showTitle||e.showSubtitle,teleport:e.teleport,closeOnPopstate:e.closeOnPopstate,safeAreaInsetTop:e.safeAreaInsetTop,closeOnClickOverlay:e.closeOnClickOverlay,"onUpdate:show":J},{default:fe}):fe()}});const lt=Ee(tt);export{lt as C};
