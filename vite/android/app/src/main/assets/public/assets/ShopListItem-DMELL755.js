import{C as Q,E as W,r as L,b5 as re,b6 as de,as as he,j as V,J as ue,b7 as Y,o as fe,A as q,b8 as ee,b as m,T as me,N as pe,M as te,b9 as ge,ba as ve,bb as N,bc as M,L as xe,bd as B,be as J,bf as _e,a1 as ye,aw as Se,av as ke,bg as be,bh as Ce,U as ne,k as K,g as y,c as C,d as T,v as P,w,F as D,q as E,t as I,x as Z,y as G}from"./index-C0qELFvz.js";import{C as Te}from"./index-KpkTHw7S.js";import{T as Re}from"./index-DpkCpmyv.js";import"./index-l99pA0pT.js";import{S as we}from"./index-CzMMTJ2E.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Ie(){return Array(26).fill("").map((t,p)=>String.fromCharCode(65+p))}const[oe,U]=Q("index-bar"),Le={sticky:pe,zIndex:te,teleport:[String,Object],highlightColor:String,stickyOffsetTop:ge(0),indexList:{type:Array,default:Ie}},se=Symbol(oe);var Be=W({name:oe,props:Le,emits:["select","change"],setup(e,{emit:o,slots:t}){const p=L(),a=L(),u=L(""),k=re(),f=de(p),{children:i,linkChildren:S}=he(se);let h;S({props:e});const l=V(()=>{if(ue(e.zIndex))return{zIndex:+e.zIndex+1}}),g=V(()=>{if(e.highlightColor)return{color:e.highlightColor}}),A=(n,s)=>{for(let r=i.length-1;r>=0;r--){const d=r>0?s[r-1].height:0,c=e.sticky?d+e.stickyOffsetTop:0;if(n+c>=s[r].top)return r}return-1},$=n=>i.find(s=>String(s.index)===n),O=()=>{if(ve(p))return;const{sticky:n,indexList:s}=e,r=N(f.value),d=M(f),c=i.map(b=>b.getRect(f.value,d));let v=-1;if(h){const b=$(h);if(b){const x=b.getRect(f.value,d);e.sticky&&e.stickyOffsetTop?v=A(x.top-e.stickyOffsetTop,c):v=A(x.top,c)}}else v=A(r,c);u.value=s[v],n&&i.forEach((b,x)=>{const{state:_,$el:le}=b;if(x===v||x===v-1){const R=le.getBoundingClientRect();_.left=R.left,_.width=R.width}else _.left=null,_.width=null;if(x===v)_.active=!0,_.top=Math.max(e.stickyOffsetTop,c[x].top-r)+d.top;else if(x===v-1&&h===""){const R=c[v].top-r;_.active=R>0,_.top=R+d.top-c[x].height}else _.active=!1}),h=""},z=()=>{xe(O)};Y("scroll",O,{target:f,passive:!0}),fe(z),q(()=>e.indexList,z),q(u,n=>{n&&o("change",n)});const ie=()=>e.indexList.map(n=>{const s=n===u.value;return m("span",{class:U("index",{active:s}),style:s?g.value:void 0,"data-index":n},[n])}),F=n=>{h=String(n);const s=$(h);if(s){const r=N(f.value),d=M(f),{offsetHeight:c}=document.documentElement;if(s.$el.scrollIntoView(),r===c-d.height){O();return}e.sticky&&e.stickyOffsetTop&&(B()===c-d.height?J(B()):J(B()-e.stickyOffsetTop)),o("select",s.index)}},j=n=>{const{index:s}=n.dataset;s&&F(s)},ce=n=>{j(n.target)};let H;const ae=n=>{if(k.move(n),k.isVertical()){_e(n);const{clientX:s,clientY:r}=n.touches[0],d=document.elementFromPoint(s,r);if(d){const{index:c}=d.dataset;c&&H!==c&&(H=c,j(d))}}},X=()=>m("div",{ref:a,class:U("sidebar"),style:l.value,onClick:ce,onTouchstartPassive:k.start},[ie()]);return ee({scrollTo:F}),Y("touchmove",ae,{target:a}),()=>{var n;return m("div",{ref:p,class:U()},[e.teleport?m(me,{to:e.teleport},{default:()=>[X()]}):X(),(n=t.default)==null?void 0:n.call(t)])}}});const[Oe,Pe]=Q("index-anchor"),De={index:te};var Ee=W({name:Oe,props:De,setup(e,{slots:o}){const t=ye({top:0,left:null,rect:{top:0,height:0},width:null,active:!1}),p=L(),{parent:a}=Se(se);if(!a)return;const u=()=>t.active&&a.props.sticky,k=V(()=>{const{zIndex:i,highlightColor:S}=a.props;if(u())return ke(be(i),{left:t.left?`${t.left}px`:void 0,width:t.width?`${t.width}px`:void 0,transform:t.top?`translate3d(0, ${t.top}px, 0)`:void 0,color:S})});return ee({state:t,getRect:(i,S)=>{const h=M(p);return t.rect.height=h.height,i===window||i===document.body?t.rect.top=h.top+B():t.rect.top=h.top+N(i)-S.top,t.rect}}),()=>{const i=u();return m("div",{ref:p,style:{height:i?`${t.rect.height}px`:void 0}},[m("div",{style:k.value,class:[Pe({sticky:i}),{[Ce]:i}]},[o.default?o.default():e.index])])}}});const Ue=ne(Ee),Ve=ne(Be),Ne={name:"ShopList",data(){return{shop:{name:"",location:""},value:"",groupedShops:[],indexList:[],totalShops:0,UseSearch:!1,SearchResult:[]}},props:{parentMethod:{type:Function},isDie:{type:Boolean}},mounted(){this.fetchShopData()},methods:{handleClick(e){this.$emit("selectShop",e),console.log(e)},async fetchShopData(){const e=await K.shop.groupShopsByPinyin();this.groupedShops=this.transformData(e),this.totalShops=this.calculateTotal(this.groupedShops),this.$emit("total-change",this.totalShops),this.indexList=this.generateIndexList(this.groupedShops)},calculateTotal(e){return e.reduce((o,t)=>o+t.items.length,0)},generateIndexList(e){return e.map(o=>o.index.toUpperCase())},transformData(e){return Object.keys(e).sort().map(o=>({index:o.toUpperCase(),items:e[o].map(t=>({id:t.id,name:t.name,location:t.location,priceRule:{color:t.priceRule.color,name:t.priceRule.name}}))})).filter(o=>o.items.length>0)},async findByLike(){this.SearchResult=await K.shop.searchShops({name:this.value})},onSearch(){this.findByLike(),this.UseSearch=!0},onCancel(){this.getShops(),this.UseSearch=!1}}},Me={action:"/"},$e={style:{display:"flex","align-items":"center"}},ze={style:{"flex-shrink":"0","min-width":"35vw"}},Fe={key:0},je={style:{display:"flex","align-items":"center"}},He={style:{"flex-shrink":"0","min-width":"35vw"}};function Xe(e,o,t,p,a,u){const k=we,f=Ue,i=Re,S=Te,h=Ve;return y(),C("div",null,[T("form",Me,[m(k,{modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=l=>a.value=l),placeholder:"请输入搜索关键词","show-action":"",onCancel:u.onCancel,onSearch:u.onSearch},null,8,["modelValue","onCancel","onSearch"])]),T("div",null,[a.UseSearch?G("",!0):(y(),P(h,{key:0,"index-list":a.indexList},{default:w(()=>[(y(!0),C(D,null,E(a.groupedShops,l=>(y(),C("div",{key:l.index},[m(f,{index:l.index},null,8,["index"]),(y(!0),C(D,null,E(l.items,g=>(y(),P(S,{key:g.id,label:g.location,border:"",center:"",onClick:A=>u.handleClick(g)},{title:w(()=>[T("div",$e,[T("span",ze,I(g.name),1),m(i,{color:g.priceRule.color},{default:w(()=>[Z(I(g.priceRule.name),1)]),_:2},1032,["color"])])]),_:2},1032,["label","onClick"]))),128))]))),128))]),_:1},8,["index-list"]))]),a.UseSearch?(y(),C("div",Fe,[(y(!0),C(D,null,E(a.SearchResult,l=>(y(),P(S,{key:l.id,label:l.location,border:"",center:"",onClick:g=>u.handleClick(l)},{title:w(()=>[T("div",je,[T("span",He,I(l.name),1),m(i,{color:l.priceRule.color},{default:w(()=>[Z(I(l.priceRule.name),1)]),_:2},1032,["color"])])]),_:2},1032,["label","onClick"]))),128))])):G("",!0)])}const Qe=Ae(Ne,[["render",Xe]]);export{Qe as _};
