import{r as n,a1 as A,o as H,a2 as F,p as C,c as g,b as h,d as o,w as k,u as b,v as I,y as j,a3 as G,e as J,B as K,g as r,t as l,x as B,F as Q,q as W,a0 as X}from"./index-C0qELFvz.js";import{L as Z}from"./index-Cp1fqY-c.js";import{E as tt}from"./index-JzpjVZKK.js";/* empty css              */import"./index-C-sx0Abo.js";import{C as et}from"./index-CRs7Aw4B.js";import{C as at}from"./index-KpkTHw7S.js";import{N as ot}from"./index-DvCqQQ0t.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-tab-status-Bni8MSz3.js";import"./use-id-DTylsVlq.js";import"./use-refs-HP3ZCcq4.js";const nt={class:"product-order-container"},rt={class:"search-form"},lt={key:0},ct={key:1,class:"text-gray"},dt={class:"search-buttons"},it={class:"order-list"},ut={class:"order-info"},pt={class:"order-header"},vt={class:"order-time"},_t={class:"order-id"},mt={class:"order-shop"},ft={class:"order-content"},gt={class:"order-quantity"},ht={class:"order-price"},Dt={class:"unit-price"},yt={class:"total-price"},kt={__name:"orderList",setup(xt){const D=n(!1),v=n(!1),c=n(!1),y=n(!1),i=n([]),x=n(""),_=n(0),L=n(10),M=new Date(new Date().getFullYear()-1,0,1),P=new Date,a=A({productId:null,startDate:null,endDate:null,page:0,size:10}),w=G(),q=J(),z=()=>{const t=w.params.id||w.query.productId;return x.value=w.query.productName,t?Number(t):(C("缺少商品ID参数"),N(),null)};H(async()=>{const t=z();t&&(a.productId=t,S())});const S=async()=>{D.value=!0,_.value=0,i.value=[],c.value=!1;try{const t=await F.getProductOrderList({productId:a.productId,startDate:a.startDate,endDate:a.endDate,page:_.value,size:L.value});i.value=t.content||[],c.value=!t.hasNext}catch(t){console.error("获取订单列表失败:",t),C("获取数据失败，请稍后重试"),c.value=!0}finally{D.value=!1,v.value=!1}},V=async()=>{if(!c.value){v.value=!0,_.value++;try{const t=await F.getProductOrderList({productId:a.productId,startDate:a.startDate,endDate:a.endDate,page:_.value,size:L.value});t.content&&t.content.length>0&&(i.value=[...i.value,...t.content]),c.value=!t.hasNext}catch(t){console.error("加载更多数据失败:",t),C("加载更多数据失败"),c.value=!0}finally{v.value=!1}}},E=([t,e])=>{const u=d=>{const p=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,"0"),f=String(d.getDate()).padStart(2,"0");return`${p}-${m}-${f}`};a.startDate=u(t),a.endDate=u(e),y.value=!1},R=()=>{a.startDate=null,a.endDate=null,_.value=0,S()},N=()=>{q.back()},T=t=>{if(!t)return"";const e=new Date(t),u=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0"),m=String(e.getHours()).padStart(2,"0"),f=String(e.getMinutes()).padStart(2,"0");return`${u}-${d}-${p} ${m}:${f}`},$=t=>parseFloat(t).toFixed(2);return(t,e)=>{const u=ot,d=at,p=K,m=et,f=tt,Y=Z,O=X;return r(),g("div",nt,[h(u,{title:x.value?`${x.value}销售记录`:"商品销售记录",fixed:"","left-arrow":"","left-text":"返回",onClickLeft:N},null,8,["title"]),o("div",rt,[h(d,{"is-link":"",title:"时间范围",onClick:e[0]||(e[0]=s=>y.value=!0)},{value:k(()=>[a.startDate&&a.endDate?(r(),g("span",lt,l(a.startDate)+" 至 "+l(a.endDate),1)):(r(),g("span",ct,"选择日期范围"))]),_:1}),o("div",dt,[h(p,{block:"",type:"primary",onClick:S},{default:k(()=>e[3]||(e[3]=[B("查询")])),_:1}),h(p,{block:"",plain:"",onClick:R},{default:k(()=>e[4]||(e[4]=[B("重置")])),_:1})])]),h(m,{show:y.value,"onUpdate:show":e[1]||(e[1]=s=>y.value=s),"max-date":b(P),"min-date":b(M),color:"#1989fa","first-day-of-week":"1",type:"range",onConfirm:E},null,8,["show","max-date","min-date"]),o("div",it,[i.value.length===0&&!D.value?(r(),I(f,{key:0,description:"暂无销售记录"})):(r(),I(Y,{key:1,loading:v.value,"onUpdate:loading":e[2]||(e[2]=s=>v.value=s),finished:c.value,"immediate-check":!1,"finished-text":"没有更多订单了",onLoad:V},{default:k(()=>[(r(!0),g(Q,null,W(i.value,(s,U)=>(r(),g("div",{key:U,class:"order-item"},[o("div",ut,[o("div",pt,[o("span",vt,l(T(s.orderTime)),1),o("span",_t,"订单号: "+l(s.orderId),1)]),o("div",mt,l(s.shopName),1)]),o("div",ft,[o("div",gt,l(s.quantity)+" 个",1),o("div",ht,[o("div",Dt,"单价: ¥"+l($(s.salePrice)),1),o("div",yt,"¥"+l($(s.totalSalesAmount)),1)])])]))),128))]),_:1},8,["loading","finished"]))]),D.value?(r(),I(O,{key:0,class:"page-loading",color:"#1989fa",type:"spinner"})):j("",!0)])}}},qt=st(kt,[["__scopeId","data-v-53f6e126"]]);export{qt as default};
